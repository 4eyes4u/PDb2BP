<!DOCTYPE html>
<html lang="en">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Uvod u razvojno okruženje Hibernate | Programiranje Db2 baza podataka</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Uvod u razvojno okruženje Hibernate" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Elektronska knjiga “Programiranje Db2 baza podataka” dostupna besplatno na adresi" />
<meta property="og:description" content="Elektronska knjiga “Programiranje Db2 baza podataka” dostupna besplatno na adresi" />
<link rel="canonical" href="https://theikeofficial.github.io//PDb2BP/poglavlja/10/" />
<meta property="og:url" content="https://theikeofficial.github.io//PDb2BP/poglavlja/10/" />
<meta property="og:site_name" content="Programiranje Db2 baza podataka" />
<script type="application/ld+json">
{"description":"Elektronska knjiga “Programiranje Db2 baza podataka” dostupna besplatno na adresi","@type":"WebPage","url":"https://theikeofficial.github.io//PDb2BP/poglavlja/10/","headline":"Uvod u razvojno okruženje Hibernate","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/PDb2BP/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://theikeofficial.github.io//PDb2BP/feed.xml" title="Programiranje Db2 baza podataka" /></head>
<body><header class="site-header" role="banner"
    style="background-image: url(/PDb2BP/resources/header.png); height: 300px; background-repeat: repeat-x;"><a class="site-title" rel="author" href="/PDb2BP/"
        style="display: flex; position: relative; top: 125px; background-color: white; width: 100%; height: 86px;flex-wrap: wrap; justify-content: center; align-items: center; line-height: 0px; font-size: 36px;">
        
        
        <span style="font-weight: bold;">PROGRAMIRANJE&nbsp;</span>
        
        <span style="font-weight: bold;">DB2&nbsp;</span>
        
        <span style="font-weight: bold;">BAZA&nbsp;</span>
        
        <span style="font-weight: bold;">PODATAKA&nbsp;</span>
        
    </a>
</header><main class="page-content" aria-label="Content">
        <div class="wrapper" style="max-width: calc(1100px - (30px * 2));">
            <article class="post">

  <header class="post-header">
    <h1 class="post-title">10. Uvod u razvojno okruženje Hibernate</h1>
  </header>

  <div class="post-content">
    <p>Prilikom izrade aplikacija, Java programeri se oslanjaju na objektno-orijentisane koncepte
koji, kako im i samo ime kaže, počivaju na upotrebi objekata (i naravno, ostalih koncepata
koji se dalje zasnivaju na njima, poput klase, učauravanja, interfejsi i drugi). Ovi objekti
modeliraju poslovnu logiku iz realnog sveta, definisanu od strane naručilaca proizvoda.
Podaci u memoriji, sa kojima aplikacija upravlja, nisu korisni ukoliko se ne mogu negde
trajno skladištiti. Dodatno, veliki broj podataka počiva upravo iz nekih skladišta podataka,
te je potrebno da aplikacije pristupaju takvim izvorima informacija. Tradicionalno,
ali i dalje u ogromnoj meri, ovi podaci se zapisuju u relacionim bazama podataka zbog
različitih prednosti koje su nam poznate iz dobro razrađene teorije relacionog računa na
kojima ove baze podataka počivaju.</p>

<p>Ovim se otvara naredno pitanje — ako Java aplikacije rade sa podacima u memoriji koji su
zapisani kao objekti, a naši podaci od interesa se skladište u relacionim bazama podataka
koji su zapisani u tabelama, da li je moguće dizajnirati sistem koji će automatski izvršiti
prevođenje podataka iz jednog oblika u drugi i obrnuto? Ovaj problem se naziva problem
objektno-relacionog preslikavanja (engl. Object-Relation Mapping problem) i odgovor na
pitanje je da može. U ovom poglavlju biće predstavljeno okruženje za razvoj Hibernate,
koje omogućava Java programerima da u svojim aplikacijama implementiraju poslovnu
logiku, dok se operacije niskog nivoa, kao što su čitanje, skladištenje, brisanje i menjanje
podataka, izvršavaju u pozadini, čime se veliki deo posla olakšava.</p>

<p>In this chapter, we’ll think of the problems of data storage and sharing in the context of
an object-oriented application that uses a domain model. Instead of directly working
with the rows and columns of a java.sql.ResultSet, the business logic of an application interacts with the application-specific object-oriented domain model. If the SQL
database schema of an online auction system has ITEM and BID tables, for example,
the Java application defines Item and Bid classes. Instead of reading and writing the
value of a particular row and column with the ResultSet API, the application loads
and stores instances of Item and Bid classes.</p>

<p>At runtime, the application therefore operates with instances of these classes.
Each instance of a Bid has a reference to an auction Item, and each Item may have a
collection of references to Bid instances. The business logic isn’t executed in the
database (as an SQL stored procedure); it’s implemented in Java and executed in the
application tier. This allows business logic to use sophisticated object-oriented concepts such as inheritance and polymorphism.</p>

<p>Upotreba Hibernate okruženja za razvoj će biti prikazana kroz jedan veći primer, koji će
biti izrađen deo-po-deo. Ovo znači da, pored toga što će se u projektu povećavati broj
klasa sa (gotovo) svakim zahtevom, i same klase će biti proširivane kako bi zadovoljile sve
zahteve.</p>

<p>Cilj ovog poglavlja jeste razvoj aplikacije koja ispunjava naredne zahteve (svi zahtevi se
implementiraju nad poznatom bazom podataka <code class="highlighter-rouge">VSTUD</code>):</p>

<ol>
  <li>Unos podataka o novom smeru u tabelu <code class="highlighter-rouge">SMER</code> sa narednim podacima:</li>
</ol>

<table>
  <thead>
    <tr>
      <th>Kolona</th>
      <th>Vrednost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Identifikator</td>
      <td>300</td>
    </tr>
    <tr>
      <td>Oznaka</td>
      <td>MATF_2019</td>
    </tr>
    <tr>
      <td>Naziv</td>
      <td>Novi MATF smer u 2019. godini</td>
    </tr>
    <tr>
      <td>Broj semestara</td>
      <td>8</td>
    </tr>
    <tr>
      <td>Broj bodova</td>
      <td>240</td>
    </tr>
    <tr>
      <td>Zvanje</td>
      <td>Diplomirani informaticar</td>
    </tr>
    <tr>
      <td>Opis</td>
      <td>Novi smer na Matematickom fakultetu</td>
    </tr>
  </tbody>
</table>

<ol start="2">
  <li>Brisanje podataka o prethodno unetom smeru iz tabele <code class="highlighter-rouge">SMER</code>.</li>
  <li>Unos podataka o novom ispitnom roku (jun 2019. godine) u tabelu <code class="highlighter-rouge">ISPITNI_ROK</code>.</li>
  <li>Brisanje podataka o prethodno unetom ispitnom roku iz tabele <code class="highlighter-rouge">ISPITNI_ROK</code>.</li>
  <li>Ispisivanje podataka o svim ispitnim rokovima.</li>
  <li>Ispisivanje podataka o ispitnom roku čija se oznaka roka i godina roka unose sa standarnog ulaza.</li>
  <li>Ispisivanje naziva svih smerova. Nakon svakog naziva smera, ispisuju se indeks, ime i prezime svih studenata na tom smeru. Dopuniti ispis o studentu tako da se za svakog studenta ispisuje i prosek.</li>
  <li>Za zadati indeks studenta ispisati nazive svih položenih predmeta i dobijene ocene. Implementirati dva metoda — jedan koji ne koristi Hibernate JPA Criteria API i drugi koji ga koristi.</li>
</ol>

<p>Takođe, omogućiti da obrada svakog zahteva predstavlja zasebnu transakciju.</p>

<h2 id="101-podešavanje-hibernate-projekta">10.1 Podešavanje Hibernate projekta</h2>

<p>Hibernate biblioteka se veoma jednostavno instalira. Sa veze <a href="https://hibernate.org/orm/">https://hibernate.org/orm/</a> potrebno je preuzeti odgovarajuću verziju biblioteke. Mi ćemo raditi sa poslednjom stabilnom verzijom, a to je verzija 5.4 koja se može preuzeti klikom na dugme <em>Download Zip archive</em> sa <a href="https://hibernate.org/orm/releases/5.4/">ove veze</a>. Preuzetu arhivu je potrebno otpakovati na neku lokaciju. Na virtualnoj mašini “Baze podataka 2019”, ta lokacija je <code class="highlighter-rouge">/opt/hibernate-5.4.10/</code>. Dodatno, Java projekat koji budemo kreirali mora da sadrži informaciju i o implementaciji JDBC drajvera za DB2. Podešavanje Java projekta sa podrškom za razvoj Hibernate aplikacija se vrši narednim koracima:</p>

<ol>
  <li>Otvoriti IBM Data Studio.</li>
  <li>Iz glavnog menija odabrati <em>Window</em> -&gt; <em>Perspective</em> -&gt; <em>Open Perspective</em> -&gt; <em>Other</em> -&gt; <em>Java</em> -&gt; <em>OK</em></li>
  <li>
    <p>Iz glavnog menija odabrati <em>File</em> -&gt; <em>New</em> -&gt; <em>Java Project</em></p>

    <ol>
      <li>U polje <em>Project name</em> uneti naziv Java projekta: <code class="highlighter-rouge">poglavlje_10</code>.</li>
      <li>Iz padajuće liste u tački <em>Use an execution environment JRE</em> odabrati <em>JavaSE-1.8</em>.</li>
      <li>Odabrati <em>Finish</em>.</li>
    </ol>
  </li>
  <li>
    <p>Desni klik na projekat koji je napravljen u <em>Package Explorer</em> -&gt; <em>Properties</em></p>

    <ol>
      <li>Odabrati iz leve liste tab <em>Java Build Path</em>.</li>
      <li>Odabrati iz gornje liste karticu <em>Libraries</em>.</li>
      <li>
        <p>Podesiti podršku za JDBC:</p>

        <ol>
          <li>Odabrati <em>Add External JARS</em>.</li>
          <li>U prozoru koji se otvori odabrati: <em>Other Locations</em> -&gt; <em>Computer</em> -&gt; <em>opt</em> -&gt; <em>ibm</em> -&gt; <em>db2</em> -&gt; <em>V11.5</em> -&gt; <em>java</em>.</li>
          <li>Sa ove lokacije označiti datoteke <em>db2jcc4.jar</em> i <em>db2jcc_licence_cu.jar</em>, pa odabrati <em>OK</em>.</li>
        </ol>
      </li>
      <li>
        <p>Podesiti podršku za Hibernate:</p>

        <ol>
          <li>Odabrati <em>Add Library</em>.</li>
          <li>U prozoru koji se otvori odabrati: <em>User Library</em> -&gt; <em>Next</em> -&gt; <em>User Libraries</em> -&gt; <em>New</em> -&gt; Uneti naziv <em>Hibernate</em> -&gt; <em>OK</em>.</li>
          <li>
            <p>Sada je potrebno dodati sve pakete koji se nalaze u poddirektorijumima <code class="highlighter-rouge">envers</code>, <code class="highlighter-rouge">jpa-metamodel-generator</code>, <code class="highlighter-rouge">osgi</code> i <code class="highlighter-rouge">required</code> na putanji <code class="highlighter-rouge">/opt/hibernate-5.4.10/lib/</code>. Postupak će biti opisan za direktorijum <code class="highlighter-rouge">envers</code>, a Vi treba da ga ponovite korak-po-korak za sve ostale navedene direktorijume.</p>

            <ol>
              <li>Kliknuti na napravljenu biblioteku <em>Hibernate</em> (da bi Vam bilo omogućeno dugme <em>Add External JARS</em>).</li>
              <li>Odabrati <em>Add External JARS</em>.</li>
              <li>U prozoru koji se otvori odabrati: <em>Other Locations</em> -&gt; <em>Computer</em> -&gt; <em>opt</em> -&gt; <em>hibernate-5.4.10</em> -&gt; <em>lib</em> -&gt; <em>envers</em>.</li>
              <li>Sa ove lokacije označiti sve datoteke, pa odabrati <em>OK</em>.</li>
            </ol>
          </li>
          <li>Kada su svi potrebni paketi uključeni, odabrati <em>OK</em> -&gt; <em>Finish</em> -&gt; <em>OK</em>.</li>
        </ol>
      </li>
      <li>Ovim ste uspešno dodali podršku za JDBC i Hibernate aplikacije u Vašem projektu.</li>
    </ol>
  </li>
</ol>

<h2 id="102-podešavanje-konekcije-na-bazu-podataka">10.2 Podešavanje konekcije na bazu podataka</h2>

<p>To create a connection to the database, Hibernate must know the details of our database,
tables, classes, and other mechanics. This information is ideally provided as an XML file
(usually named <code class="highlighter-rouge">hibernate.cfg.xml</code>) or as a simple text file with name/value pairs (usually
named <code class="highlighter-rouge">hibernate.properties</code>).</p>

<p>For this exercise, we use XML style. We name this file <code class="highlighter-rouge">hibernate.cfg.xml</code> so the framework
can load this file automatically.</p>

<p>The following snippet describes such a configuration file. Because we are using IBM DB2
as the database, the connection details for the IBM DB2 database are declared in this
<code class="highlighter-rouge">hibernate.cfg.xml</code> file.</p>

<p>Da bismo napravili ovu datoteku, potrebno je da desnim klikom na naziv projekta otvorimo
padajući meni iz kojeg biramo <em>New</em> -&gt; <em>Other</em> i onda pronađemo <em>XML File</em> iz filtera
<em>XML</em>. Klikom na <em>Next</em>, potrebno je da unesemo naziv datoteke — u ovom slučaju, to je
<em>hibernate.cfg.xml</em>, odaberemo da se datoteka smesti u direktorijum <em>src</em> i odaberemo
<em>Finish</em>.</p>

<p>Ova datoteka će se automatski otvoriti u XML pregledaču, ali je nama neophodno da
bude otvorena kao tekstualna datoteka. Ovo se može uraditi desnim klikom na naziv
datoteke <code class="highlighter-rouge">hibernate.cfg.xml</code> u <em>Package Explorer</em> pogledu, a zatim biranjem 
<em>Open with</em> -&gt; <em>Text Editor</em>. U ovu datoteku je potrebno smestiti sledeće:</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/hibernate.cfg.xml</code>:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;hibernate-configuration&gt;</span>
   	<span class="nt">&lt;session-factory&gt;</span>
   		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connection.url"</span><span class="nt">&gt;</span>
   			jdbc:db2://localhost:50001/VSTUD
   		<span class="nt">&lt;/property&gt;</span>
    	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connection.driver_class"</span><span class="nt">&gt;</span>
    		com.ibm.db2.jcc.DB2Driver
    	<span class="nt">&lt;/property&gt;</span>
   		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.username"</span><span class="nt">&gt;</span>
   			student
   		<span class="nt">&lt;/property&gt;</span>
   		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.password"</span><span class="nt">&gt;</span>
   			abcdef
   		<span class="nt">&lt;/property&gt;</span>
   		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.dialect"</span><span class="nt">&gt;</span>
   			org.hibernate.dialect.DB2Dialect
   		<span class="nt">&lt;/property&gt;</span>
	<span class="nt">&lt;/session-factory&gt;</span>
<span class="nt">&lt;/hibernate-configuration&gt;</span>

</code></pre></div></div>

<p>This file has enough information to get a live connection to an IBM DB2 database.</p>

<p>The preceding properties can also be expressed as name/value pairs. For example, here’s
the same information represented as name/value pairs in a text file titled <code class="highlighter-rouge">hibernate.properties</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hibernate.connection.driver_class = com.ibm.db2.jcc.DB2Driver
hibernate.dialect = org.hibernate.dialect.DB2Dialect
hibernate.connection.url = jdbc:db2://localhost:50001/VSTUD
hibernate.connection.username = student
hibernate.connection.password = abcdef
</code></pre></div></div>

<p>Property <code class="highlighter-rouge">connection.url</code> indicates the URL to which we should be connected; <code class="highlighter-rouge">driver_class</code>
represents the relevant <code class="highlighter-rouge">Driver</code> class to make a connection, and the <code class="highlighter-rouge">dialect</code> indicates which
database dialect we are using (IBM DB2, in this case). Similarly, <code class="highlighter-rouge">connection.username</code>
and <code class="highlighter-rouge">connection.password</code> specifies the username and password for connecting to a database.</p>

<p>If you are following the <code class="highlighter-rouge">hibernate.properties</code> file approach, note that all the properties
are prefixed with “<code class="highlighter-rouge">hibernate</code>” and follow a pattern — <code class="highlighter-rouge">hibernate.∗ = value</code>.</p>

<h2 id="103-fabrika-sesija">10.3 Fabrika sesija</h2>

<p>Pre nego što pređemo na implementiranje klasa i definisanje preslikavanja između tabela
u bazi podataka i klasa u programskom jeziku Java, pogledajmo kako se može kreirati
jednostavan klijent koji će koristiti informacije iz <code class="highlighter-rouge">hibernate.cfg.xml</code> datoteke
za kreiranje konekcije ka bazi podataka.</p>

<p>Hibernate’s native bootstrap API is split into several stages, each giving you access
to certain configuration aspects. Building a <code class="highlighter-rouge">SessionFactory</code> looks like this:</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/zadatak_10_1/HibernateUtil.java</code>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.SessionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.MetadataSources</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.registry.StandardServiceRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.registry.StandardServiceRegistryBuilder</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">HibernateUtil</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">StandardServiceRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">configure</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
            <span class="n">sessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MetadataSources</span><span class="o">(</span><span class="n">registry</span><span class="o">).</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="n">Smer</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">buildMetadata</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">buildSessionFactory</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Session factory error"</span><span class="o">);</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="n">SessionFactory</span> <span class="nf">getSessionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sessionFactory</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>First, create a <code class="highlighter-rouge">StandardServiceRegistry</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">StandardServiceRegistry</span> <span class="n">registry</span> <span class="o">=</span> 
        <span class="k">new</span> <span class="nf">StandardServiceRegistryBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">configure</span><span class="o">()</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">StandardServiceRegistryBuilder</code> helps you create the immutable service registry with chained method calls. Configure the services registry by calling the method <code class="highlighter-rouge">configure</code> on it. Finally, call the method <code class="highlighter-rouge">build</code> to create said service registry.</p>

<p>With the <code class="highlighter-rouge">StandardServiceRegistry</code> built and immutable, you can move on to the next
stage: telling Hibernate which persistent classes are part of your mapping metadata.
Configure the metadata sources as follows:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MetadataSources</span> <span class="n">metadataSources</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MetadataSources</span><span class="o">(</span><span class="n">serviceRegistry</span><span class="o">);</span>
<span class="n">metadataSources</span><span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="n">Smer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">MetadataBuilder</span> <span class="n">metadataBuilder</span> <span class="o">=</span> <span class="n">metadataSources</span><span class="o">.</span><span class="na">getMetadataBuilder</span><span class="o">();</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">MetadataSources</code> API has many methods for adding mapping sources; check the
Javadoc for more information. The next stage of the boot procedure is building all
the metadata needed by Hibernate, with the <code class="highlighter-rouge">MetadataBuilder</code> you obtained from the
metadata sources.</p>

<p>You can then query the metadata to interact with Hibernate’s completed configuration programmatically, or continue and build the final <code class="highlighter-rouge">SessionFactory</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Metadata</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">metadataBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="na">buildSessionFactory</span><span class="o">();</span>
</code></pre></div></div>

<p>This builder helps you create the immutable service registry with chained method calls.</p>

<p>Opisani kod stavljamo u statički blok klase <code class="highlighter-rouge">HibernateUtil</code> kako bi se on izvršio prvi put kada se ova klasa bude koristila. U našem slučaju, to podrazumeva prvi put kada instanca fabrike sesija bude bila iskorišćena u <code class="highlighter-rouge">main</code> funkciji naše aplikacije.</p>

<p>Note that we don’t have to explicitly mention the mapping or configuration or properties
files, because the Hibernate runtime looks for default filenames, such as <code class="highlighter-rouge">hibernate.cfg.xml</code>
or <code class="highlighter-rouge">hibernate.properties</code>, in the classpath and loads them. If we have a nondefault
name, make sure you pass that as an argument — like <code class="highlighter-rouge">configure("my-hib-cfg.xml")</code>, for example.</p>

<h2 id="104-objektno-relaciono-preslikavanje-jedne-klase">10.4 Objektno-relaciono preslikavanje jedne klase</h2>

<div style="border: 2px solid rgb(196, 41, 255); padding: 5px; background-color: rgba(197, 197, 197, 0.3); margin: 10px 0;">
    <p style="font-weight: bold;">Zadatak 10.1</p>
    Napisati Hibernate program kojim se unosi podatak o novom smeru u tabeli <span style="color: #e83e8c; background-color: #eef; padding: 1px 5px; font-family: SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;">SMER</span> sa podacima iz naredne tabele.
</div>

<table>
  <thead>
    <tr>
      <th>Kolona</th>
      <th>Vrednost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Identifikator</td>
      <td>300</td>
    </tr>
    <tr>
      <td>Oznaka</td>
      <td>MATF_2019</td>
    </tr>
    <tr>
      <td>Naziv</td>
      <td>Novi MATF smer u 2019. godini</td>
    </tr>
    <tr>
      <td>Broj semestara</td>
      <td>8</td>
    </tr>
    <tr>
      <td>Broj bodova</td>
      <td>240</td>
    </tr>
    <tr>
      <td>Zvanje</td>
      <td>Diplomirani informaticar</td>
    </tr>
    <tr>
      <td>Opis</td>
      <td>Novi smer na Matematickom fakultetu</td>
    </tr>
  </tbody>
</table>

<p>Rešenje: Da bismo rešili ovaj zadatak, potrebno je da kreiramo klasu <code class="highlighter-rouge">Smer</code> i da joj dodamo svojstva koja odgovaraju kolonama u tabeli <code class="highlighter-rouge">SMER</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_1</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Smer</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id_smera</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Oznaka</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Naziv</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">Semestara</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">Bodovi</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">Nivo</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Zvanje</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Opis</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Primetimo da je klasa <code class="highlighter-rouge">Smer</code> definisana na nivou vidljivosti paketa. Za ovo smo se opredelili zbog toga što će implementacija svakog novog zahteva zahtevati novi paket u projektu <code class="highlighter-rouge">poglavlje_10</code>. Trenutne klase koje smo napisali - <code class="highlighter-rouge">HibernateUtil</code> i <code class="highlighter-rouge">Smer</code> - čuvaju se u paketu <code class="highlighter-rouge">zadatak_10_1</code> i važe samo za njega, tako da nema potrebe da budu javne vidljivosti.</p>

<p>Sada je potrebno da definišemo objektno-relaciono preslikavanje između klase <code class="highlighter-rouge">Smer</code> i tabele <code class="highlighter-rouge">SMER</code> u bazi podataka.</p>

<p>U Hibernate radnom okviru je moguće korišćenje dva pristupa za definisanje preslikavanja:</p>

<ol>
  <li>
    <p>Korišćenjem XML datoteka — Za svaku tabelu se definiše XML datoteka koja je struktuirana na odgovarajući način i koristi XML elemente i njihove atribute za definisanje preslikavanja.</p>
  </li>
  <li>
    <p>Korišćenjem Java anotacija — Koriste se Java konstrukti oblika  <code class="highlighter-rouge">@NazivAnotacije</code> i njihova svojstva za definisanje preslikavanja.</p>
  </li>
</ol>

<p>Mi ćemo u daljem tekstu koristiti pristup zasnovan na Java anotacijama.</p>

<p>Hibernate uses the Java Persistence API (JPA) annotations. JPA is the standard specification dictating the persistence of Java objects. So the preceding annotations are imported from the <code class="highlighter-rouge">javax.persistence</code> package.</p>

<p>Each persistent object is tagged (at a class level) with an <code class="highlighter-rouge">@Entity</code> annotation. The <code class="highlighter-rouge">@Table</code> annotation declares our database table where these entities will be stored. Ideally, we should not have to provide the <code class="highlighter-rouge">@Table</code> annotation if the name of the class and the table name are the same (in our example, the class is <code class="highlighter-rouge">Smer</code>, whereas the table name is <code class="highlighter-rouge">SMER</code>, which is fine):</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SMER"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Smer</span> <span class="o">{</span>
    <span class="o">...</span>
</code></pre></div></div>

<p>Sada je potrebno da definišemo preslikavanje kolona. All persistent entities must have their identifiers defined. The <code class="highlighter-rouge">@Id</code> annotation indicates that the variable is the unique identifier of the object instance (in other words, a primary key). When we annotate the id_smera variable with the <code class="highlighter-rouge">@Id</code> annotation, as in the preceding example, Hibernate maps a field called <code class="highlighter-rouge">id_smera</code> from our table <code class="highlighter-rouge">Smer</code> to the <code class="highlighter-rouge">id_smera</code> variable on the <code class="highlighter-rouge">Smer</code> class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SMER"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Smer</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id_smera</span><span class="o">;</span>
    <span class="o">...</span>
</code></pre></div></div>

<p>If your variable doesn’t match the column name, you must specify the column name using the <code class="highlighter-rouge">@Column</code> annotation. Dodatno, ukoliko kolona ne može imati <code class="highlighter-rouge">NULL</code> vrednosti u bazi podataka, potrebno je postaviti još i svojstvo <code class="highlighter-rouge">nullable</code> na vrednost <code class="highlighter-rouge">false</code> u anotaciji <code class="highlighter-rouge">@Column</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SMER"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Smer</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id_smera</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"oznaka"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Oznaka</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"naziv"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Naziv</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"semestara"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">Semestara</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"bodovi"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">Bodovi</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id_nivoa"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">Nivo</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"zvanje"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Zvanje</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"opis"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Opis</span><span class="o">;</span>
    <span class="o">...</span>
</code></pre></div></div>

<p>Takođe, s obzirom da su ova svojstva deklarisana modifikatorom <code class="highlighter-rouge">private</code>, potrebno je implementirati metode za postavljanje i dohvatanje njihovih vrednosti. U ovu svrhu, može nam pomoći alat IBM Data Studio:</p>

<ul>
  <li>Desni klik na prazan deo koda -&gt; <em>Source</em> -&gt; <em>Generate Getters and Setters</em> -&gt; <em>Select All</em> -&gt; <em>OK</em></li>
</ul>

<p>Ovim će nam biti generisane odgovarajuće metode. Možete istražiti sve mogućnosti ove opcije, kao što su generisanje samo postavljačkih ili dohvatačkih metoda, generisanje metoda samo za neka svojstva i drugo.</p>

<p>Cela implementacija klase <code class="highlighter-rouge">Smer</code> data je u nastavku.</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/zadatak_10_1/Smer.java</code>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="c1">// Svaki trajni objekat mora biti dekorisan anotacijom @Entity. </span>
<span class="c1">// Anotacija @Table je neophodna jer se ime klase i ime tabele razlikuju.</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"SMER"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Smer</span> <span class="o">{</span>
    <span class="c1">// Anotacija @Id znaci da svojstvo koje ono dekorise</span>
    <span class="c1">// predstavlja jedinstveni identifikator instance objekta (tj. primarni</span>
    <span class="c1">// kljuc).</span>
    <span class="c1">// Ime polja i ime kolone u bazi je isto u ovom slucaju.</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id_smera</span><span class="o">;</span>

    <span class="c1">// Za svojstvo Oznaka, ime kolone u bazi podataka je "oznaka",</span>
    <span class="c1">// pa je dodatno ime kolone naglaseno kroz svojstvo name anotacije @Column.</span>
    <span class="c1">// Dodatno, u bazi oznaka ova kolona ne moze biti null,</span>
    <span class="c1">// pa dodajemo svojstvo nullable = false anotaciji @Column.</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"oznaka"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Oznaka</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"naziv"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Naziv</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"semestara"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">Semestara</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"bodovi"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">Bodovi</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id_nivoa"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">Nivo</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"zvanje"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Zvanje</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"opis"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Opis</span><span class="o">;</span>

    <span class="c1">// Automatski generisani dohvatacki i postavljacki metodi:</span>
    <span class="c1">// 1. Desni klik na prazan deo koda</span>
    <span class="c1">// 2. Source &gt; Generate Getters and Setters...</span>
    <span class="c1">// 3. Select All</span>
    <span class="c1">// 4. OK</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId_smera</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id_smera</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId_smera</span><span class="o">(</span><span class="kt">int</span> <span class="n">id_smera</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id_smera</span> <span class="o">=</span> <span class="n">id_smera</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getOznaka</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Oznaka</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOznaka</span><span class="o">(</span><span class="n">String</span> <span class="n">oznaka</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Oznaka</span> <span class="o">=</span> <span class="n">oznaka</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getNaziv</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Naziv</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNaziv</span><span class="o">(</span><span class="n">String</span> <span class="n">naziv</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Naziv</span> <span class="o">=</span> <span class="n">naziv</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getSemestara</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Semestara</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSemestara</span><span class="o">(</span><span class="n">Integer</span> <span class="n">semestara</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Semestara</span> <span class="o">=</span> <span class="n">semestara</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getBodovi</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Bodovi</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBodovi</span><span class="o">(</span><span class="n">Integer</span> <span class="n">bodovi</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Bodovi</span> <span class="o">=</span> <span class="n">bodovi</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getNivo</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Nivo</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNivo</span><span class="o">(</span><span class="n">Integer</span> <span class="n">nivo</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Nivo</span> <span class="o">=</span> <span class="n">nivo</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getZvanje</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Zvanje</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setZvanje</span><span class="o">(</span><span class="n">String</span> <span class="n">zvanje</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Zvanje</span> <span class="o">=</span> <span class="n">zvanje</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getOpis</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Opis</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOpis</span><span class="o">(</span><span class="n">String</span> <span class="n">opis</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Opis</span> <span class="o">=</span> <span class="n">opis</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<h2 id="105-unos-jednog-sloga">10.5 Unos jednog sloga</h2>

<p>Napišimo sada i klasu <code class="highlighter-rouge">Main</code> koja će sadržati statički metod <code class="highlighter-rouge">main</code> u kojem ćemo testirati rad naše aplikacije. Trenutno, metod <code class="highlighter-rouge">main</code> će uraditi dve stvari: prva je pozivanje statičke funkcije za unos novog smera, a druga je zatvaranje fabrike sesija:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Session</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.Transaction</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Pocetak rada\n"</span><span class="o">);</span>
        
        <span class="n">insertSmer</span><span class="o">();</span>
        
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Zavrsetak rada\n"</span><span class="o">);</span>
        
        <span class="c1">// Zatvaranje fabrike sesija</span>
        <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="o">...</span>
</code></pre></div></div>

<p>Sada prelazimo na implementaciju metoda <code class="highlighter-rouge">insertSmer</code> koji treba da unese novi red u tabelu <code class="highlighter-rouge">Smer</code>.</p>

<p>Sve akcije nad bazom podataka se izvršavaju u okviru tzv. <em>sesija</em> (engl. <em>session</em>). Da bismo mogli da radimo sa bazom podataka, potrebno je da otvorimo novu sesiju, što nam je omogućeno metodom <code class="highlighter-rouge">openSession</code> iz klase <code class="highlighter-rouge">SessionFactory</code>.</p>

<p>Sledeći korak jeste kreiranje objekta klase <code class="highlighter-rouge">Smer</code> i postavljanje odgovarajućih vrednosti. Na ovaj način smo podatke smestili u memoriju računara. Ono što je potrebno uraditi da bi se oni trajno skladištili u bazu podataka jeste pozvati metod <code class="highlighter-rouge">save</code> nad objektom sesije (tj. instancom klase <code class="highlighter-rouge">Session</code> koju smo dobili pozivom <code class="highlighter-rouge">openSession</code>). Na kraju, potrebno je da zatvorimo sesiju. Kod bi mogao da izgleda kao u nastavku:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">insertSmer</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
    <span class="n">Smer</span> <span class="n">smer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Smer</span><span class="o">();</span>
    
    <span class="n">smer</span><span class="o">.</span><span class="na">setId_smera</span><span class="o">(</span><span class="mi">300</span><span class="o">);</span>
    <span class="n">smer</span><span class="o">.</span><span class="na">setOznaka</span><span class="o">(</span><span class="s">"MATF_2019"</span><span class="o">);</span>
    <span class="n">smer</span><span class="o">.</span><span class="na">setNaziv</span><span class="o">(</span><span class="s">"Novi MATF smer u 2019. godini"</span><span class="o">);</span>
    <span class="n">smer</span><span class="o">.</span><span class="na">setSemestara</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>
    <span class="n">smer</span><span class="o">.</span><span class="na">setBodovi</span><span class="o">(</span><span class="mi">240</span><span class="o">);</span>
    <span class="n">smer</span><span class="o">.</span><span class="na">setNivo</span><span class="o">(</span><span class="mi">110</span><span class="o">);</span>
    <span class="n">smer</span><span class="o">.</span><span class="na">setZvanje</span><span class="o">(</span><span class="s">"Diplomirani informaticar"</span><span class="o">);</span>
    <span class="n">smer</span><span class="o">.</span><span class="na">setOpis</span><span class="o">(</span><span class="s">"Novi smer na Matematickom fakultetu"</span><span class="o">);</span>
    
    <span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">smer</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Smer je sacuvan"</span><span class="o">);</span>
    
    <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Iz ovog dela koda vidimo koliko je jednostavno trajno skladištiti podatke u bazu podataka, koji su se nalazili u memoriji računara. Ipak, postoji još jedna stvar kojom treba dopuniti prethodni kod.</p>

<h2 id="106-implementacija-transakcija">10.6 Implementacija transakcija</h2>

<p>Napomenuli smo na početku poglavlja da aplikacija koju budemo kreirali mora da radi tako da svaki zahtev predstavlja jednu transakciju. Ono što je dobra vest jeste da je definisanje transakcija u Hibernate radnom okviru veoma jednostavna procedura. Pogledajmo naredni kod:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
<span class="n">Smer</span> <span class="n">smer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Smer</span><span class="o">();</span>

<span class="c1">// Postavljanje odgovarajucih vrednosti za smer ide ovde ...</span>

<span class="n">Transaction</span> <span class="n">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
    
    <span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">smer</span><span class="o">);</span>
    
    <span class="n">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Smer je sacuvan"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Cuvanje smera nije uspelo! Transakcija se ponistava!"</span><span class="o">);</span>
    
    <span class="k">if</span> <span class="o">(</span><span class="n">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Transakcije se u Hibernate radnom okviru predstavljaju klasom <code class="highlighter-rouge">Transaction</code>. We initiate a transaction by invoking the <code class="highlighter-rouge">session.beginTrasaction()</code> method, which creates a new <code class="highlighter-rouge">Transaction</code> object and returns the reference to us. It gets associated with the session and is open until that transaction is committed or rolled back.</p>

<p>We perform the required work in a transaction, then issue a commit on this transaction. At this stage, the entities are persisted to the database. While persisting, if for whatever reason there are any errors, the Hibernate runtime will catch and throw a <code class="highlighter-rouge">HibernateException</code> (which is an unchecked <code class="highlighter-rouge">RuntimeException</code>). We then have to catch the exception and roll back the transaction.</p>

<p>Cela implementacija klase <code class="highlighter-rouge">Main</code> data je u nastavku.</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/zadatak_10_1/Main.java</code>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Session</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.Transaction</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Pocetak rada\n"</span><span class="o">);</span>
        
        <span class="n">insertSmer</span><span class="o">();</span>
        
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Zavrsetak rada\n"</span><span class="o">);</span>
        
        <span class="c1">// Zatvaranje fabrike sesija</span>
        <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">insertSmer</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Otvaranje sesije</span>
        <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
        <span class="c1">// Kreiranje objekta klase Smer.</span>
        <span class="c1">// U ovom objektu ce biti zapisane sve informacije o novom smeru,</span>
        <span class="c1">// koje ce zatim biti skladistene u bazi podataka.</span>
        <span class="n">Smer</span> <span class="n">smer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Smer</span><span class="o">();</span>
        
        <span class="c1">// Postavljanje odgovarajucih vrednosti za smer</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setId_smera</span><span class="o">(</span><span class="mi">300</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setOznaka</span><span class="o">(</span><span class="s">"MATF_2019"</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setNaziv</span><span class="o">(</span><span class="s">"Novi MATF smer u 2019. godini"</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setSemestara</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setBodovi</span><span class="o">(</span><span class="mi">240</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setNivo</span><span class="o">(</span><span class="mi">110</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setZvanje</span><span class="o">(</span><span class="s">"Diplomirani informaticar"</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setOpis</span><span class="o">(</span><span class="s">"Novi smer na Matematickom fakultetu"</span><span class="o">);</span>
        
        <span class="n">Transaction</span> <span class="n">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// Zapocinjemo novu transakciju</span>
            <span class="n">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
            
            <span class="c1">// Skladistimo kreirani smer u tabelu SMER u bazi podataka</span>
            <span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">smer</span><span class="o">);</span>
            <span class="c1">// Pohranjivanje izmena i zavrsavanje transakcije</span>
            <span class="n">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
            
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Smer je sacuvan"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Doslo je do greske: ponistavamo izmene u transakciji</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Cuvanje smera nije uspelo! Transakcija se ponistava!"</span><span class="o">);</span>
            
            <span class="k">if</span> <span class="o">(</span><span class="n">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="c1">// Bilo da je doslo do uspeha ili do neuspeha,</span>
            <span class="c1">// duzni smo da zatvorimo sesiju</span>
            <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h2 id="107-dohvatanje-jednog-sloga">10.7 Dohvatanje jednog sloga</h2>

<p>S obzirom da smo u prethodnom primeru postavili sva preslikavanja i pripremne korake,
ispostaviće se da se dohvatanje jednog sloga iz baze podataka sastoji u jednostavnom
pozivanju odgovarajućih metoda. Nakon što dohvatimo jedan slog, možemo ga menjati ili
obrisati, o čemu će biti reči u narednoj sekciji.</p>

<p>Ukoliko je potrebno da pronađemo (dohvatimo) red iz tabele sa odgovarajućim primarnim
ključem, na raspolaganju nam je metod <code class="highlighter-rouge">load()</code> definisan nad objektima klase <code class="highlighter-rouge">Session</code>.
Postoji više preopterećenja ovog metoda, a ono koje ćemo mi koristiti jeste potpisa:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">,</span> <span class="n">Serializable</span> <span class="n">id</span><span class="o">)</span>
</code></pre></div></div>

<p>Prvi argument ovog metoda bi trebalo da bude prazna instanca klase reda koji želimo da
učitamo, a drugi argument je instanca primarnog ključa. Nakon izvršavanja ovog metoda,
objekat object će biti popunjen vrednostima iz kolona reda čiji je primarni ključ zadat sa
<code class="highlighter-rouge">id</code>.</p>

<p>Ukoliko nismo sigurni da slog sa zadatim primarnim ključem postoji u tabeli, nije dobro
koristiti metod <code class="highlighter-rouge">load()</code>. U tom slučaju, bolje je koristiti metod <code class="highlighter-rouge">get()</code>. Razlika je u tome
što, ukoliko primarni ključ nije pronađen u bazi podataka, metod <code class="highlighter-rouge">load()</code> će izbaciti izuzetak,
dok će metod <code class="highlighter-rouge">get()</code> vratiti null referencu, što je lakše za korišćenje. Ipak, njegova
upotreba je nešto drugačija jer su nam na raspolaganju naredna dva preopterećenja:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">get</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">clazz</span><span class="o">,</span> <span class="n">Serializable</span> <span class="n">id</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">entityName</span><span class="o">,</span> <span class="n">Serializable</span> <span class="n">id</span><span class="o">)</span>
</code></pre></div></div>

<p>Prvi od njih je šablonskog tipa i koristi klasu da odredi iz koje tabele dohvata slog, a drugi
koristi naziv entiteta, koji je moguće dobiti poziv metoda <code class="highlighter-rouge">getEntityName()</code> nad objektom
klase <code class="highlighter-rouge">Session</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="n">String</span> <span class="nf">getEntityName</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">)</span>
</code></pre></div></div>

<p>Slede primeri kodova koji koriste metod <code class="highlighter-rouge">get()</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Get an id from some other Java class,</span>
<span class="c1">// for instance, through a web application</span>
<span class="n">Supplier</span> <span class="n">supplier</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Supplier</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">supplier</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Supplier not found for id "</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
    <span class="k">return</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// ili...</span>

<span class="n">String</span> <span class="n">entityName</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getEntityName</span><span class="o">(</span><span class="n">supplier</span><span class="o">);</span>
<span class="n">Supplier</span> <span class="n">secondarySupplier</span> <span class="o">=</span>
        <span class="o">(</span><span class="n">Supplier</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">entityName</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="108-brisanje-jednog-sloga">10.8 Brisanje jednog sloga</h2>

<p>Brisanje slogova iz baze podataka se jednostavno vrši pozivanjem metoda <code class="highlighter-rouge">delete()</code> nad
objektom klase <code class="highlighter-rouge">Session</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span><span class="o">)</span>
</code></pre></div></div>

<p>Argument ovog metoda je trajni objekat. Naravno, postoje i složeniji metodi brisanja
podataka.</p>

<div style="border: 2px solid rgb(196, 41, 255); padding: 5px; background-color: rgba(197, 197, 197, 0.3); margin: 10px 0;">
    <p style="font-weight: bold;">Zadatak 10.2</p>
    Dopuniti prethodni zadatak tako da implementira brisanje podataka o prethodno unetom smeru iz tabele <span style="color: #e83e8c; background-color: #eef; padding: 1px 5px; font-family: SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;">SMER</span>.
</div>

<p>Rešenje: Kako smo već napisali OR preslikavanje između klase <code class="highlighter-rouge">Smer</code> i tabele <code class="highlighter-rouge">SMER</code>, sve što je potrebno da uradimo jeste da kreiramo statički metod <code class="highlighter-rouge">deleteSmer()</code> u glavnoj klasi <code class="highlighter-rouge">Main.java</code> i pozovemo ga u metodi <code class="highlighter-rouge">main</code>. Prikazujemo dopunjenu klasu <code class="highlighter-rouge">Main.java</code>:</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/zadatak_10_2/Main.java</code>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_2</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Session</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.Transaction</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Pocetak rada\n"</span><span class="o">);</span>

        <span class="n">insertSmer</span><span class="o">();</span>
        <span class="n">deleteSmer</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Zavrsetak rada\n"</span><span class="o">);</span>
        <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">insertSmer</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
        <span class="n">Smer</span> <span class="n">smer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Smer</span><span class="o">();</span>

        <span class="n">smer</span><span class="o">.</span><span class="na">setId_smera</span><span class="o">(</span><span class="mi">300</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setOznaka</span><span class="o">(</span><span class="s">"MATF_2019"</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setNaziv</span><span class="o">(</span><span class="s">"Novi MATF smer u 2019. godini"</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setSemestara</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setBodovi</span><span class="o">(</span><span class="mi">240</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setNivo</span><span class="o">(</span><span class="mi">110</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setZvanje</span><span class="o">(</span><span class="s">"Diplomirani informaticar"</span><span class="o">);</span>
        <span class="n">smer</span><span class="o">.</span><span class="na">setOpis</span><span class="o">(</span><span class="s">"Novi smer na Matematickom fakultetu"</span><span class="o">);</span>

        <span class="n">Transaction</span> <span class="n">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

            <span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">smer</span><span class="o">);</span>
            <span class="n">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>

            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Smer je sacuvan"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Cuvanje smera nije uspelo! Transakcija se ponistava!"</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">deleteSmer</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
        <span class="n">Smer</span> <span class="n">smer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Smer</span><span class="o">();</span>

        <span class="n">Transaction</span> <span class="n">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

            <span class="c1">// Ucitavanje (dohvatanje) smera na osnovu primarnog kljuca</span>
            <span class="n">session</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">smer</span><span class="o">,</span> <span class="mi">300</span><span class="o">);</span>
            <span class="c1">// Brisanje ucitanog smera iz baze</span>
            <span class="n">session</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">smer</span><span class="o">);</span>

            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Smer obrisan"</span><span class="o">);</span>

            <span class="c1">// Potvrdjivanje i zavrsavanje transakcije</span>
            <span class="n">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Brisanje smera nije uspelo! Ponistavanje transakcije!"</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<h2 id="109-složeni-ključ">10.9 Složeni ključ</h2>

<p>Upravljanje tabelama koje imaju jednostavne primarne ključeve, kao što je to tabela <code class="highlighter-rouge">SMER</code>,
vrlo je jednostavno. Nešto složenije je rukovati tabelom čiji se primarni ključ sastoji od
nekoliko kolona. Takvi primarni ključevi se nazivaju <em>složeni ključevi</em> (engl. <em>compound primary key</em>).</p>

<p>You must create a class to represent this primary key. It will not require a primary key
of its own, of course, but it must be visible to entity class, must have a default constructor,
must be serializable, and must implement <code class="highlighter-rouge">hashCode()</code> and <code class="highlighter-rouge">equals()</code> methods to allow the
Hibernate code to test for primary key collisions (i.e., they must be implemented with the
appropriate database semantics for the primary key values).</p>

<p>Your three strategies for using this primary key class once it has been created are as
follows:</p>

<ol>
  <li>
    <p>Mark it as <code class="highlighter-rouge">@Embeddable</code> and add to your entity class a normal property for it, marked
with <code class="highlighter-rouge">@Id</code>.</p>
  </li>
  <li>
    <p>Add to your entity class a normal property for it, marked with <code class="highlighter-rouge">@EmbeddableId</code>.</p>
  </li>
  <li>
    <p>Add properties to your entity class for all of its fields, mark them with <code class="highlighter-rouge">@Id</code>, and
mark your entity class with <code class="highlighter-rouge">@IdClass</code>, supplying the class of your primary key class.</p>
  </li>
</ol>

<p>Hajde da prođemo kroz svaku od opisanih strategija i prikažemo njihove primere.</p>

<h3 id="1091-prva-strategija---embeddable-i-id">10.9.1 Prva strategija - <code class="highlighter-rouge">@Embeddable</code> i <code class="highlighter-rouge">@Id</code></h3>

<p>The use of <code class="highlighter-rouge">@Id</code> with a class marked as <code class="highlighter-rouge">@Embeddable</code>, as shown in the following example, is
the most natural approach. The <code class="highlighter-rouge">@Embeddable</code> annotation allows you to treat the compound
primary key as a single property, and it permits the reuse of the <code class="highlighter-rouge">@Embeddable</code> class in other
tables.</p>

<p>Iz <code class="highlighter-rouge">CPKBook.java</code> datoteke:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Ovo je klasa koja ima slozeni kljuc ISBN</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CPKBook</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="n">ISBN</span> <span class="n">id</span><span class="o">;</span>
    
    <span class="o">...</span>
    
<span class="o">}</span>
</code></pre></div></div>

<p>Iz <code class="highlighter-rouge">ISBN.java</code> datoteke:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Ovo je klasa koja predstavlja slozeni kljuc:</span>
<span class="c1">// 1. Anotiramo je anotacijom @Embeddable</span>
<span class="nd">@Embeddable</span>
<span class="c1">// 2. Implementira interfejs java.io.Serializable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ISBN</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="c1">// Naziv "group" je nevalidan naziv kolone u SQL-u</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"group_number"</span><span class="o">)</span> 
    <span class="kt">int</span> <span class="n">group</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">publisher</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">title</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">checkdigit</span><span class="o">;</span>
    
    <span class="c1">// 3. Ima podrazumevani konstruktor</span>
    <span class="kd">public</span> <span class="nf">ISBN</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
    
    <span class="c1">// Get i set metodi</span>
    <span class="o">...</span>
    
    <span class="c1">// 4. Prevazilazi metode equals i hashCode</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">ISBN</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        
        <span class="n">ISBN</span> <span class="n">isbn</span> <span class="o">=</span> <span class="o">(</span><span class="n">ISBN</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
    
        <span class="k">if</span> <span class="o">(</span><span class="n">checkdigit</span> <span class="o">!=</span> <span class="n">isbn</span><span class="o">.</span><span class="na">checkdigit</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">group</span> <span class="o">!=</span> <span class="n">isbn</span><span class="o">.</span><span class="na">group</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">publisher</span> <span class="o">!=</span> <span class="n">isbn</span><span class="o">.</span><span class="na">publisher</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">title</span> <span class="o">!=</span> <span class="n">isbn</span><span class="o">.</span><span class="na">title</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">group</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">publisher</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">checkdigit</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="1092-druga-strategija---embeddedid">10.9.2 Druga strategija - <code class="highlighter-rouge">@EmbeddedId</code></h3>

<p>The next most natural approach is the use of the <code class="highlighter-rouge">@EmbeddedId</code> annotation. Here, the primary key
class cannot be used in other tables since it is not an <code class="highlighter-rouge">@Embeddable</code> entity, but it does allow
us to treat the key as a single attribute of the “table class”.</p>

<p>Često se ovakva klasa implementira kao deo klase koja preslikava tabelu, upravo iz razloga što 
predstavlja njen deo, tj. neće se koristiti kao primarni ključ neke druge klase.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmbeddedPKBook</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="n">EmbeddedISBN</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span>
    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    
    <span class="c1">// Get/set metodi</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">EmbeddedISBN</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
        <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"group_number"</span><span class="o">)</span>
        <span class="kt">int</span> <span class="n">group</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">publisher</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">title</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">checkdigit</span><span class="o">;</span>
        
        <span class="kd">public</span> <span class="nf">ISBN</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>
        
        <span class="c1">// Get/set metodi, equals, hashCode...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="1093-treća-strategija---idclass-i-id">10.9.3 Treća strategija - <code class="highlighter-rouge">@IdClass</code> i <code class="highlighter-rouge">@Id</code></h3>

<p>Finally, the use of the <code class="highlighter-rouge">@IdClass</code> and <code class="highlighter-rouge">@Id</code> annotations allows us to map the compound
primary key class using properties of the entity itself corresponding to the names of the
properties in the primary key class. The names must correspond (there is no mechanism
for overriding this), and the primary key class must honor the same obligations as with
the other two techniques. The only advantage to this approach is its ability to “hide” the
use of the primary key class from the interface of the enclosing entity.</p>

<p>The <code class="highlighter-rouge">@IdClass</code> annotation takes a value parameter of <code class="highlighter-rouge">Class</code> type, which must be the class
to be used as the compound primary key. The fields that correspond to the properties of
the primary key class to be used must all be annotated with <code class="highlighter-rouge">@Id</code> — note in the following
code example that the class properties <code class="highlighter-rouge">group</code>, <code class="highlighter-rouge">publisher</code>, <code class="highlighter-rouge">title</code> and <code class="highlighter-rouge">checkdigit</code> are so
annotated, and the <code class="highlighter-rouge">EmbeddedISBN</code> class is not mapped as <code class="highlighter-rouge">@Embeddable</code>, but it is supplied as
the value of the <code class="highlighter-rouge">@IdClass</code> annotation.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="n">IdClassBook</span><span class="o">.</span><span class="na">EmbeddedISBN</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IdClassBook</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kt">int</span> <span class="n">group</span><span class="o">;</span>
    <span class="nd">@Id</span>
    <span class="kt">int</span> <span class="n">publisher</span><span class="o">;</span>
    <span class="nd">@Id</span>
    <span class="kt">int</span> <span class="n">title</span><span class="o">;</span>
    <span class="nd">@Id</span>
    <span class="kt">int</span> <span class="n">checkdigit</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">IdClassBook</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
    
    <span class="c1">// Get/set metodi</span>
    
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">EmbeddedISBN</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
        <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"group_number"</span><span class="o">)</span>
        <span class="kt">int</span> <span class="n">group</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">publisher</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">title</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">checkdigit</span><span class="o">;</span>
        
        <span class="kd">public</span> <span class="nf">ISBN</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>
        
        <span class="c1">// Get/set metodi, equals, hashCode...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div style="border: 2px solid rgb(196, 41, 255); padding: 5px; background-color: rgba(197, 197, 197, 0.3); margin: 10px 0;">
    <p style="font-weight: bold;">Zadatak 10.3</p>
    Dopuniti prethodni zadatak tako da implementira unos podataka o novom ispitnom roku (jun 2019. godine) u tabelu <span style="color: #e83e8c; background-color: #eef; padding: 1px 5px; font-family: SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;">ISPITNI_ROK</span>.
</div>

<p>Rešenje: Potrebno je da prvo napravimo klasu
koja će predstavljati složeni ključ. Nazovimo je <code class="highlighter-rouge">IspitniRokId</code>. U nastavku je data njena
implementacija. Obratiti pažnju na metode <code class="highlighter-rouge">equals()</code> i <code class="highlighter-rouge">hashCode()</code>. Definicije ovih metoda
će biti gotovo identične za sve klase koje ih prevazilaze iz klase <code class="highlighter-rouge">Object</code>:</p>

<ul>
  <li>
    <p>Metod <code class="highlighter-rouge">equals()</code> prvo ispituje da li je reference objekata <code class="highlighter-rouge">this</code> i <code class="highlighter-rouge">o</code> (koji se prosleđuje
kao argument metoda) poklapaju. Zatim proverava da li drugi objekat (<code class="highlighter-rouge">o</code>) predstavlja referencu 
iste klase kao objekat sa kojim se poredi (<code class="highlighter-rouge">this</code>). Zatim proverava da
li se svi atributi objekata poklapaju pozivajući metod <code class="highlighter-rouge">Objects.equals</code> za svaki par
atributa.</p>
  </li>
  <li>
    <p>Metod <code class="highlighter-rouge">hashCode()</code> jednostavno poziva metod <code class="highlighter-rouge">Objects.hash</code> koja prima proizvoljni
broj argumenata i vraća heš vrednost na osnovu njihovih vrednosti. Obično je bolje
koristiti ovaj metod nego implementirati svoju heš funkciju.</p>
  </li>
</ul>

<p>Cela implementacija je data u nastavku:</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/zadatak_10_3/IspitniRokId.java</code>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Embeddable</span><span class="o">;</span>

<span class="c1">// Tabela ISPITNI_ROK ima primarni kljuc koji se sastoji od dve kolone. </span>
<span class="c1">// Ovakav primarni kljuc se naziva slozeni kljuc.</span>
<span class="c1">// Za slozeni kljuc je potrebno da se kreira posebna klasa </span>
<span class="c1">// koja mora da implementira interfejs java.io.Serializable. </span>
<span class="c1">// Stoga moraju biti definisana i naredna dva metoda: equals() i hashCode(). </span>
<span class="c1">// Takodje, neophodno je da ima definisan i podrazumevani konstruktor.</span>

<span class="c1">// S obzirom da se ova klasa koristi kao primarni kljuc za drugu klasu,</span>
<span class="c1">// onda je ne anotiramo pomocu @Entity,</span>
<span class="c1">// vec koristimo anotaciju @Embeddable</span>
<span class="nd">@Embeddable</span>
<span class="kd">class</span> <span class="nc">IspitniRokId</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="c1">// Podrazumevani serijski ID verzije</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="c1">// Kolone koje ulaze u primarni kljuc</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">godina</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">oznaka</span><span class="o">;</span>

    <span class="c1">// Podrazumevani konstruktor</span>
    <span class="kd">public</span> <span class="nf">IspitniRokId</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">IspitniRokId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">godina</span><span class="o">,</span> <span class="n">String</span> <span class="n">oznaka</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">godina</span> <span class="o">=</span> <span class="n">godina</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">oznaka</span> <span class="o">=</span> <span class="n">oznaka</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Autogenerisani get/set metodi</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getGodina</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">godina</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGodina</span><span class="o">(</span><span class="n">Integer</span> <span class="n">godina</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">godina</span> <span class="o">=</span> <span class="n">godina</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getOznaka</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">oznaka</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOznaka</span><span class="o">(</span><span class="n">String</span> <span class="n">oznaka</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">oznaka</span> <span class="o">=</span> <span class="n">oznaka</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Prevazilazenje metoda radi testiranja kolizije primarnih kljuceva</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">IspitniRokId</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">IspitniRokId</span> <span class="n">irOther</span> <span class="o">=</span> <span class="o">(</span><span class="n">IspitniRokId</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>

        <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">godina</span><span class="o">,</span> <span class="n">irOther</span><span class="o">.</span><span class="na">getGodina</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">oznaka</span><span class="o">,</span> <span class="n">irOther</span><span class="o">.</span><span class="na">getOznaka</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">godina</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">oznaka</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>Zatim je potrebno specifikovati instancu ove klase kao primarni ključ klase <code class="highlighter-rouge">IspitniRok.java</code>, 
koju takođe kreiramo:</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/zadatak_10_3/IspitniRok.java</code>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ispitni_rok"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">IspitniRok</span> <span class="o">{</span>
    <span class="c1">// Za primarni kljuc koristimo instancu klase IspitniRokId,</span>
    <span class="c1">// s obzirom da ova tabela ima slozeni kljuc.</span>
    <span class="c1">// Pogledati klasu IspitniRokId za jos informacija.</span>

    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="n">IspitniRokId</span> <span class="n">id</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="c1">// Ostale kolone</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"naziv"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Naziv</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"pocetak_prijavljivanja"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Pocetak</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"kraj_prijavljivanja"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Kraj</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"tip"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">Tip</span> <span class="o">=</span> <span class="s">"B"</span><span class="o">;</span>

    <span class="c1">// Autogenerisani Get/Set metodi</span>

    <span class="kd">public</span> <span class="n">IspitniRokId</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">IspitniRokId</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getNaziv</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Naziv</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNaziv</span><span class="o">(</span><span class="n">String</span> <span class="n">naziv</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Naziv</span> <span class="o">=</span> <span class="n">naziv</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPocetak</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Pocetak</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPocetak</span><span class="o">(</span><span class="n">String</span> <span class="n">pocetak</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Pocetak</span> <span class="o">=</span> <span class="n">pocetak</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getKraj</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Kraj</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setKraj</span><span class="o">(</span><span class="n">String</span> <span class="n">kraj</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Kraj</span> <span class="o">=</span> <span class="n">kraj</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTip</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Tip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Zelimo da podrzimo automatsko biranje tipa</span>
    <span class="c1">// ukoliko korisnik prosledi null.</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTip</span><span class="o">(</span><span class="n">String</span> <span class="n">tip</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">tip</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Tip</span> <span class="o">=</span> <span class="s">"B"</span><span class="o">;</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">Tip</span> <span class="o">=</span> <span class="n">tip</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>Definisane klase se sada jednostavno koriste u metodu <code class="highlighter-rouge">insertIspitniRok()</code> proširene klase
<code class="highlighter-rouge">Main.java</code> iz prethodnog primera:</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/zadatak_10_3/Main.java</code>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Session</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.Transaction</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Pocetak rada\n"</span><span class="o">);</span>
		
		<span class="n">insertSmer</span><span class="o">();</span>
		<span class="n">deleteSmer</span><span class="o">();</span>
		<span class="n">insertIspitniRok</span><span class="o">();</span>
		
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Zavrsetak rada\n"</span><span class="o">);</span>
		<span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">insertSmer</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
		<span class="n">Smer</span> <span class="n">smer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Smer</span><span class="o">();</span>
		
		<span class="n">smer</span><span class="o">.</span><span class="na">setId_smera</span><span class="o">(</span><span class="mi">300</span><span class="o">);</span>
		<span class="n">smer</span><span class="o">.</span><span class="na">setOznaka</span><span class="o">(</span><span class="s">"MATF_2019"</span><span class="o">);</span>
		<span class="n">smer</span><span class="o">.</span><span class="na">setNaziv</span><span class="o">(</span><span class="s">"Novi MATF smer u 2019. godini"</span><span class="o">);</span>
		<span class="n">smer</span><span class="o">.</span><span class="na">setSemestara</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>
		<span class="n">smer</span><span class="o">.</span><span class="na">setBodovi</span><span class="o">(</span><span class="mi">240</span><span class="o">);</span>
		<span class="n">smer</span><span class="o">.</span><span class="na">setNivo</span><span class="o">(</span><span class="mi">110</span><span class="o">);</span>
		<span class="n">smer</span><span class="o">.</span><span class="na">setZvanje</span><span class="o">(</span><span class="s">"Diplomirani informaticar"</span><span class="o">);</span>
		<span class="n">smer</span><span class="o">.</span><span class="na">setOpis</span><span class="o">(</span><span class="s">"Novi smer na Matematickom fakultetu"</span><span class="o">);</span>
		
		<span class="n">Transaction</span> <span class="n">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
			
			<span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">smer</span><span class="o">);</span>
			<span class="n">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
			
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Smer je sacuvan"</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Cuvanje smera nije uspelo! Transakcija se ponistava!"</span><span class="o">);</span>
			
			<span class="k">if</span> <span class="o">(</span><span class="n">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
			<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">deleteSmer</span><span class="o">(){</span>
		<span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
		<span class="n">Smer</span> <span class="n">smer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Smer</span><span class="o">();</span>
		
		<span class="n">Transaction</span> <span class="n">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
			
			<span class="n">session</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">smer</span><span class="o">,</span> <span class="mi">300</span><span class="o">);</span> 
			<span class="n">session</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">smer</span><span class="o">);</span>
			
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Smer obrisan"</span><span class="o">);</span>
			
			<span class="n">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Brisanje smera nije uspelo! Ponistavanje transakcije!"</span><span class="o">);</span>
			
			<span class="k">if</span> <span class="o">(</span><span class="n">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
			<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>	
	<span class="o">}</span>
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">insertIspitniRok</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
		
		<span class="c1">// Kreiramo praznu instancu objekta ispitnog roka </span>
		<span class="c1">// koju cemo popuniti vrednostima koje treba sacuvati</span>
		<span class="n">IspitniRok</span> <span class="n">ir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IspitniRok</span><span class="o">();</span>
		
		<span class="c1">// Kreiramo prvo identifikator, tj. slozeni kljuc,</span>
		<span class="c1">// a zatim i ostale podatke</span>
		<span class="n">IspitniRokId</span> <span class="n">id</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IspitniRokId</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="s">"jun"</span><span class="o">);</span>
		<span class="n">ir</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
		<span class="n">ir</span><span class="o">.</span><span class="na">setNaziv</span><span class="o">(</span><span class="s">"Jun 2019"</span><span class="o">);</span>
		<span class="n">ir</span><span class="o">.</span><span class="na">setPocetak</span><span class="o">(</span><span class="s">"6/1/2019"</span><span class="o">);</span>
		<span class="n">ir</span><span class="o">.</span><span class="na">setKraj</span><span class="o">(</span><span class="s">"6/22/2018"</span><span class="o">);</span>
		<span class="c1">// Ne moramo da podesimo jer ce biti izabrana podrazumevana vrednost</span>
		<span class="c1">// ir.setTip("B");</span>
		
		<span class="c1">// Procedura za cuvanje je ista kao i do sada</span>
		<span class="n">Transaction</span> <span class="n">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
			
			<span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">ir</span><span class="o">);</span>
			
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Ispitni rok je sacuvan"</span><span class="o">);</span>
			<span class="n">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Cuvanje ispitnog roka nije uspelo! Ponistavanje transakcije!"</span><span class="o">);</span>
			
			<span class="k">if</span> <span class="o">(</span><span class="n">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
			<span class="o">}</span>
		<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
			<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>Ne zaboravimo da dodamo <code class="highlighter-rouge">IspitniRok</code> kao anotiranu klasu u konfiguraciju:</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/zadatak_10_3/HibernateUtil.java</code>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.SessionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.MetadataSources</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.registry.StandardServiceRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.registry.StandardServiceRegistryBuilder</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">HibernateUtil</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">StandardServiceRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">configure</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
            <span class="n">sessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MetadataSources</span><span class="o">(</span><span class="n">registry</span><span class="o">).</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="n">Smer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="n">IspitniRok</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">buildMetadata</span><span class="o">().</span><span class="na">buildSessionFactory</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Session factory error"</span><span class="o">);</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="n">SessionFactory</span> <span class="nf">getSessionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sessionFactory</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<div style="border: 2px solid rgb(196, 41, 255); padding: 5px; background-color: rgba(197, 197, 197, 0.3); margin: 10px 0;">
    <p style="font-weight: bold;">Zadatak 10.4</p>
    Dopuniti prethodni zadatak tako da implementira brisanje prethodno unetog ispitnog toka iz tabele <span style="color: #e83e8c; background-color: #eef; padding: 1px 5px; font-family: SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;">ISPITNI_ROK</span>.
</div>

<p>Rešenje: Sa svim znanjem do sada, ovaj zahtev se trivijalno implementira. Prikazujemo samo
ažuriranu klasu <code class="highlighter-rouge">Main.java</code> i skrećemo pažnju na njen metod <code class="highlighter-rouge">deleteIspitniRok()</code> koji
ilustruje rešenje ovog zahteva.</p>

<p>Datoteka: <code class="highlighter-rouge">primeri/poglavlje_10/src/zadatak_10_4/HibernateUtil.java</code>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zadatak_10_4</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.SessionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.MetadataSources</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.registry.StandardServiceRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.registry.StandardServiceRegistryBuilder</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">HibernateUtil</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">StandardServiceRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">configure</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
            <span class="n">sessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MetadataSources</span><span class="o">(</span><span class="n">registry</span><span class="o">).</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="n">Smer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="n">IspitniRok</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">buildMetadata</span><span class="o">().</span><span class="na">buildSessionFactory</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Session factory error"</span><span class="o">);</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="n">SessionFactory</span> <span class="nf">getSessionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sessionFactory</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

  </div>

</article>

        </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/PDb2BP/"></data>

    <div class="wrapper">

        <div class="row">
            <h2 class="footer-heading">Programiranje Db2 baza podataka</h2>
        </div>

        <div class="footer-col-wrapper">
            <div class="row">
                <div class="col-6">
                    <ul class="contact-list">
                        <li class="p-name">Programiranje Db2 baza podataka</li><li><a class="u-email" href="mailto:nikola_ajzenhamer@math.rs">nikola_ajzenhamer@math.rs</a></li></ul>
                </div>
                <div class="col-6">
                    <p>Elektronska knjiga &quot;Programiranje Db2 baza podataka&quot; dostupna besplatno na adresi&nbsp;<a
                            href="/PDb2BP/">https://theikeofficial.github.io//PDb2BP/</a>.</p>
                </div>
            </div>
        </div>

    </div>

</footer><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</body>

</html>